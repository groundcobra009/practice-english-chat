\[推論]
ユーザー入力「GeminiのようなチャットUIで英語学習を行えるシステム。AIからメッセージが来た後に、ユーザーが学びたい内容を送ると3つのメッセージが別々の吹き出しで返る。吹き出しには音声アイコンとブックマークアイコン。音声で発音再生、ブックマークで保存・削除は確認モーダルあり。」から、目的は「対話型で英語表現を効率学習し、必要表現を音声と共に蓄積できること」。MVPでは(1)チャット体験、(2)3件の学習メッセージ生成、(3)TTSによる発音再生、(4)ブックマーク保存/一覧/削除(確認付き)、(5)最低限のアカウント・データ永続化が中核。UIはモバイル優先のWebで実装し、LLMとTTSはマネージドAPIを利用。最短で価値検証するため、文法診断や長期カリキュラムは後回し。

\[要件定義書]

1. 背景・目的

* 対話型AIを用いて、ユーザーが「今学びたい英語表現」を素早く入手し、発音を確認しながら反復できる学習体験を提供する
* 必要表現をブックマークで蓄積し、再学習を容易にする

2. ユースケース / 想定ユーザー

* 例文や言い回しをすぐ知りたい英語学習者（初級〜中級、社会人/学生）
* 通勤・隙間時間でモバイル中心に学習するユーザー
* スピーキングやリスニングの即時練習をしたいユーザー

3. 機能要件（MVP）

* チャットUI

  * 初回AIメッセージ（使い方案内）
  * ユーザーが学びたいトピック/日本語指示/英語キーワードを送信
  * 送信後、AIが3件の学習メッセージ（別々の吹き出し）を自動生成
  * 吹き出し内要素：例文/訳（任意）/簡単な解説（短文）
  * 吹き出し右上：音声アイコン、ブックマークアイコン
* 音声再生（TTS）

  * 吹き出しの英語文をネイティブ音声で再生
  * 再生/一時停止、再生中インジケータ
* ブックマーク

  * 吹き出しからワンタップ保存/解除
  * 解除時は確認モーダル（「削除しますか？」Yes/No）
  * ブックマーク一覧画面：保存日時順/検索（英語文テキスト）
  * 一覧からの再生・削除（削除は確認モーダル）
* セッション管理・保存

  * 最低限のユーザ登録/ログイン（Email+Password または匿名+端末ローカル→後で昇格）
  * チャット履歴の保存（直近セッション1つで可）
  * ブックマークの永続化（ユーザー毎）
* 生成制御

  * 3件生成のためのプロンプト制御（レベル指定：初級/中級の自動推定 or 手動切替）
  * 安全フィルタ（不適切表現を抑制）
* 基本設定

  * TTS音声の選択（男女/スピード±）
  * 表示言語：日本語UI（英語へ切替は任意）
* フィードバック

  * 吹き出しごとの「役に立った」簡易フィードバック（👍/👎）

4. 非機能要件

* パフォーマンス

  * 初回ロード < 3秒（4G回線想定）、TTS開始遅延 < 1.5秒、3件生成の合計応答 < 5秒目標
* 可用性・信頼性

  * サービス稼働率目標 99.5%（MVP）
  * 失敗時の再試行とユーザ通知（トースト）
* セキュリティ・プライバシー

  * 通信のHTTPS/TLS必須
  * ユーザデータはリージョン内保管（選定クラウド準拠）
  * 認証情報は安全保管（ハッシュ、JWTの短期有効+更新）
* データ保護

  * 削除要請に応じたブックマーク/履歴消去
  * LLMへの送信データ方針を明示（利用目的/保持期間）
* 対応環境

  * モバイルWeb（iOS/Androidの最新2世代）とPCブラウザ（Chrome/Edge/Safari）
  * スクリーンリーダー対応（ボタンにaria-label、キーボード操作）
* 運用・監視

  * 例外ログ、LLM/TTS呼び出し失敗率、応答時間をダッシュボード化
  * ベータ用フィードバックフォーム

5. 画面・UI要件（MVP）

* チャット画面

  * 上部ヘッダ（タイトル、ブックマーク一覧ボタン）
  * 吹き出し：3件を縦並び、各に音声・ブックマークアイコン
  * 入力エリア：テキスト、送信ボタン、レベル切替トグル
  * 読み上げ中のビジュアル（アイコン点滅/波形）
* ブックマーク一覧

  * カード/リスト表示：英語文、訳、再生、削除（ごみ箱）→削除確認モーダル
  * 検索バー、並び替え（保存順/最近再生）
* 確認モーダル

  * タイトル、対象文の冒頭表示、「削除」「キャンセル」

6. API/外部サービス（想定）

* LLM推論API（英語例文生成・解説）
* TTS API（英語音声：US/UK少なくとも1種）
* 認証基盤（Auth/SaaS）※MVPはメール+パスワード
* データベース：ユーザー/ブックマーク/履歴（RDB or SaaS）

7. データモデル（最小）

* User{id, email, password\_hash, created\_at}
* Message{id, user\_id, role(user/ai), text, created\_at, session\_id}
* Bookmark{id, user\_id, text\_en, text\_ja(optional), notes(optional), created\_at, last\_played\_at}
* Session{id, user\_id, created\_at, title(optional)}

10. スコープ外（将来拡張）

* 発話録音→発音評価、長期カリキュラム生成、復習スケジューラ（SRS）
* レベル自動判定の高精度化、画像入力、オフライン再生、ネイティブアプリ
* 教師ダッシュボード、多言語学習対応

11. 受け入れ条件（抜粋）

* ユーザーが任意のテーマを送信すると、3つの英語メッセージが別々の吹き出しで表示される
* 各吹き出しの音声アイコンで該当英語文が再生できる
* 各吹き出しのブックマークアイコンで保存でき、一覧で表示される
* ブックマーク削除時に確認モーダルが表示され、Yes選択で削除される
* モバイルブラウザで主要機能が快適に動作する
